#!/bin/bash
# tmux_list - List and manage tmux sessions

echo "=== TMUX SESSIONS ==="
echo ""

if ! tmux has-session 2>/dev/null; then
  echo "No tmux sessions running"
  exit 0
fi

# List sessions with details
tmux list-sessions -F "#{session_name}: #{session_windows} windows, #{session_attached} attached, #{session_created_string}"

echo ""
echo "Options:"
echo "1) Switch to session"
echo "2) Kill session"
echo "3) Rename session"
echo "4) Show session details"
echo "5) Exit"

read -p "Choose option (1-5): " choice

case $choice in
  1)
    echo "Available sessions:"
    sessions=($(tmux list-sessions -F "#{session_name}"))
    select session in "${sessions[@]}"; do
      if [[ -n "$session" ]]; then
        if [[ -z "$TMUX" ]]; then
          tmux attach-session -t "$session"
        else
          tmux switch-client -t "$session"
        fi
        break
      fi
    done
    ;;
  2)
    echo "Available sessions:"
    sessions=($(tmux list-sessions -F "#{session_name}"))
    select session in "${sessions[@]}"; do
      if [[ -n "$session" ]]; then
        echo -n "Kill session '$session'? (y/N): "
        read -r confirm
        if [[ "$confirm" =~ ^[Yy]$ ]]; then
          tmux kill-session -t "$session"
          echo "Session '$session' killed"
        fi
        break
      fi
    done
    ;;
  3)
    if [[ -z "$TMUX" ]]; then
      echo "Not in a tmux session"
      exit 1
    fi
    current_session=$(tmux display-message -p '#S')
    echo "Current session: $current_session"
    echo -n "New name: "
    read -r new_name
    if [[ -n "$new_name" ]]; then
      tmux rename-session "$new_name"
      echo "Session renamed to: $new_name"
    fi
    ;;
  4)
    echo "Available sessions:"
    sessions=($(tmux list-sessions -F "#{session_name}"))
    select session in "${sessions[@]}"; do
      if [[ -n "$session" ]]; then
        echo ""
        echo "=== Session Details: $session ==="
        tmux list-windows -t "$session" -F "  Window #{window_index}: #{window_name} (#{window_panes} panes)"
        break
      fi
    done
    ;;
  5)
    exit 0
    ;;
  *)
    echo "Invalid option"
    ;;
esac
