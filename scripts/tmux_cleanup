#!/bin/bash
# tmux_cleanup - Clean up tmux sessions

echo "Active tmux sessions:"
tmux list-sessions -F "#{session_name}: #{session_windows} windows, #{session_attached} attached"

echo ""
echo "Options:"
echo "1) Kill all sessions"
echo "2) Kill specific session"
echo "3) Kill unattached sessions only"
echo "4) Cancel"

read -p "Choose option (1-4): " choice

case $choice in
  1)
    echo -n "Are you sure you want to kill ALL sessions? (y/N): "
    read -r confirm
    if [[ "$confirm" =~ ^[Yy]$ ]]; then
      tmux kill-server
      echo "All sessions killed"
    else
      echo "Cleanup cancelled"
    fi
    ;;
  2)
    echo "Available sessions:"
    tmux list-sessions -F "#{session_name}"
    echo -n "Enter session name to kill: "
    read -r session_name
    if tmux has-session -t "$session_name" 2>/dev/null; then
      tmux kill-session -t "$session_name"
      echo "Session '$session_name' killed"
    else
      echo "Session '$session_name' not found"
    fi
    ;;
  3)
    echo "Killing unattached sessions..."
    tmux list-sessions -F "#{session_name}:#{session_attached}" | \
      grep ":0$" | \
      cut -d: -f1 | \
      xargs -I {} tmux kill-session -t {}
    echo "Unattached sessions killed"
    ;;
  4)
    echo "Cleanup cancelled"
    ;;
  *)
    echo "Invalid option"
    ;;
esac
